name: üöÄ Update IPTV Release & Site

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
  push:
    branches: [ main, master ]

env:
  DROPBOX_APP_KEY: hh6l23o1jizouky
  DROPBOX_APP_SECRET: 03hf3f8ligh6bwb
  PLAYLIST_ORIGINAL: /IPTV_MEGA_PLAYLIST.m3u
  PLAYLIST_PROXY: /IPTV_MEGA_PLAYLIST_PROXY.m3u

jobs:
  update-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pages: write
      id-token: write
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          pip install dropbox requests

      - name: Download from Dropbox
        id: download
        run: |
          python3 << 'EOF'
          import dropbox
          import os
          
          # –ß–∏—Ç–∞–µ–º —Ç–æ–∫–µ–Ω
          with open('dropbox_token.txt', 'r') as f:
              token = f.read().strip()
          
          db = dropbox.Dropbox(token)
          
          # –°–∫–∞—á–∏–≤–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª
          try:
              _, res = db.files_download(os.environ['PLAYLIST_ORIGINAL'])
              with open('IPTV_WORLD.m3u', 'wb') as f:
                  f.write(res.content)
              print("‚úÖ –û—Ä–∏–≥–∏–Ω–∞–ª —Å–∫–∞—á–∞–Ω")
          except Exception as e:
              print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª–∞: {e}")
              exit(1)
          
          # –°–∫–∞—á–∏–≤–∞–µ–º –ø—Ä–æ–∫—Å–∏-–≤–µ—Ä—Å–∏—é
          try:
              _, res = db.files_download(os.environ['PLAYLIST_PROXY'])
              with open('IPTV_WORLD_PROXY.m3u', 'wb') as f:
                  f.write(res.content)
              print("‚úÖ –ü—Ä–æ–∫—Å–∏-–≤–µ—Ä—Å–∏—è —Å–∫–∞—á–∞–Ω–∞")
          except Exception as e:
              print(f"‚ö†Ô∏è –ü—Ä–æ–∫—Å–∏-–≤–µ—Ä—Å–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª")
              with open('IPTV_WORLD_PROXY.m3u', 'wb') as f:
                  with open('IPTV_WORLD.m3u', 'rb') as orig:
                      f.write(orig.read())
          
          # –ü–æ–ª—É—á–∞–µ–º –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏
          try:
              # –û—Ä–∏–≥–∏–Ω–∞–ª
              try:
                  sh = db.sharing_create_shared_link_with_settings(
                      os.environ['PLAYLIST_ORIGINAL'],
                      settings=dropbox.sharing.SharedLinkSettings(
                          requested_visibility=dropbox.sharing.RequestedVisibility.public
                      )
                  )
                  link_orig = sh.url
              except:
                  existing = db.sharing_list_shared_links(path=os.environ['PLAYLIST_ORIGINAL'])
                  link_orig = existing.links[0].url if existing.links else ""
              
              # –ü—Ä–æ–∫—Å–∏
              try:
                  sh = db.sharing_create_shared_link_with_settings(
                      os.environ['PLAYLIST_PROXY'],
                      settings=dropbox.sharing.SharedLinkSettings(
                          requested_visibility=dropbox.sharing.RequestedVisibility.public
                      )
                  )
                  link_proxy = sh.url
              except:
                  existing = db.sharing_list_shared_links(path=os.environ['PLAYLIST_PROXY'])
                  link_proxy = existing.links[0].url if existing.links else ""
              
              # –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏
              direct_orig = link_orig.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('?dl=0', '') if link_orig else ""
              direct_proxy = link_proxy.replace('www.dropbox.com', 'dl.dropboxusercontent.com').replace('?dl=0', '') if link_proxy else ""
              
              # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ env –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤
              with open(os.environ['GITHUB_OUTPUT'], 'a') as f:
                  f.write f"link_orig={direct_orig}\n"
                  f.write f"link_proxy={direct_proxy}\n"
              
              print(f"üîó –û—Ä–∏–≥–∏–Ω–∞–ª: {direct_orig}")
              print(f"üîó –ü—Ä–æ–∫—Å–∏: {direct_proxy}")
              
          except Exception as e:
              print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏: {e}")
          EOF

      - name: Generate timestamp
        id: timestamp
        run: |
          echo "date=$(date +'%d.%m.%Y %H:%M')" >> $GITHUB_OUTPUT
          echo "version=$(date +'%Y.%m.%d-%H%M')" >> $GITHUB_OUTPUT

      - name: Delete old releases
        uses: dev-drprasad/delete-older-releases@v0.3.2
        with:
          keep_latest: 0
          delete_tags: true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Create new release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: v${{ steps.timestamp.outputs.version }}
          name: üåç IPTV World ${{ steps.timestamp.outputs.date }}
          body: |
            ## üöÄ IPTV World - –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –¢–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ
            
            ### üì• –ü–ª–µ–π–ª–∏—Å—Ç—ã
            
            | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Å—ã–ª–∫–∞ |
            |-----|----------|--------|
            | üåê **–°—Ç–∞–Ω–¥–∞—Ä—Ç** | –î–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω | [–°–∫–∞—á–∞—Ç—å](${{ steps.download.outputs.link_orig }}) |
            | üîí **PROXY** | –î–ª—è –†–§ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ | [–°–∫–∞—á–∞—Ç—å](${{ steps.download.outputs.link_proxy }}) |
            
            ### üõ°Ô∏è –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
            
            - **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ** - –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–µ –º–∏—Ä–∞
            - **–ê–≤—Ç–æ-–æ–±—Ö–æ–¥ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫** - –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –†–§
            - **Anti-DPI —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏** - –û–±—Ö–æ–¥ –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤
            - **DNS-over-HTTPS** - –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤
            - **CORS Proxy** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
            
            ### üì± –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            
            - ‚úÖ Android / iOS
            - ‚úÖ Smart TV (Samsung, LG, Android TV)
            - ‚úÖ Apple TV / tvOS
            - ‚úÖ Windows / macOS / Linux
            - ‚úÖ MAG Box / Enigma2
            - ‚úÖ VLC / Kodi / Perfect Player
            
            ### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –†–§
            
            –ï—Å–ª–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
            1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **PROXY-–≤–µ—Ä—Å–∏—é**
            2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ DNS: `77.88.8.8` (–Ø–Ω–¥–µ–∫—Å) –∏–ª–∏ `195.201.226.220` (–ê–Ω—Ç–∏–ó–∞–ø—Ä–µ—Ç)
            3. –í–∫–ª—é—á–∏—Ç–µ DoH (DNS-over-HTTPS) –≤ –ø–ª–µ–µ—Ä–µ
            
            ### üåü –û–Ω–ª–∞–π–Ω-–ø–ª–µ–µ—Ä
            
            –°–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: [–û—Ç–∫—Ä—ã—Ç—å –ø–ª–µ–µ—Ä](https://${{ github.repository_owner }}.github.io/IPTVMIR/player)
            
            ---
            ‚è∞ –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${{ steps.timestamp.outputs.date }}
          files: |
            IPTV_WORLD.m3u
            IPTV_WORLD_PROXY.m3u
          generate_release_notes: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Pages
        uses: actions/configure-pages@v4

      - name: Create website
        run: |
          mkdir -p _site/player
          
          # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
          cat > _site/index.html << 'HTMLEOF'
          <!DOCTYPE html>
          <html lang="ru">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>üåç IPTV World - –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –¢–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ</title>
              <style>
                  * { margin: 0; padding: 0; box-sizing: border-box; }
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
                      min-height: 100vh;
                      color: #fff;
                      overflow-x: hidden;
                  }
                  .stars {
                      position: fixed;
                      top: 0; left: 0; width: 100%; height: 100%;
                      pointer-events: none;
                      background-image: 
                          radial-gradient(2px 2px at 20px 30px, #eee, rgba(0,0,0,0)),
                          radial-gradient(2px 2px at 40px 70px, #fff, rgba(0,0,0,0)),
                          radial-gradient(2px 2px at 50px 160px, #ddd, rgba(0,0,0,0)),
                          radial-gradient(2px 2px at 90px 40px, #fff, rgba(0,0,0,0)),
                          radial-gradient(2px 2px at 130px 80px, #fff, rgba(0,0,0,0));
                      background-repeat: repeat;
                      background-size: 200px 200px;
                      animation: twinkle 5s ease-in-out infinite;
                      opacity: 0.5;
                  }
                  @keyframes twinkle {
                      0%, 100% { opacity: 0.5; }
                      50% { opacity: 0.8; }
                  }
                  .container {
                      max-width: 1200px;
                      margin: 0 auto;
                      padding: 40px 20px;
                      position: relative;
                      z-index: 1;
                  }
                  header {
                      text-align: center;
                      padding: 60px 0;
                  }
                  .logo {
                      font-size: 4rem;
                      margin-bottom: 20px;
                      animation: float 3s ease-in-out infinite;
                  }
                  @keyframes float {
                      0%, 100% { transform: translateY(0); }
                      50% { transform: translateY(-10px); }
                  }
                  h1 {
                      font-size: 3.5rem;
                      font-weight: 800;
                      background: linear-gradient(90deg, #00f260, #0575e6, #00f260);
                      background-size: 200% auto;
                      -webkit-background-clip: text;
                      -webkit-text-fill-color: transparent;
                      animation: shine 3s linear infinite;
                      margin-bottom: 20px;
                  }
                  @keyframes shine {
                      to { background-position: 200% center; }
                  }
                  .subtitle {
                      font-size: 1.3rem;
                      color: rgba(255,255,255,0.8);
                      max-width: 600px;
                      margin: 0 auto;
                      line-height: 1.6;
                  }
                  .globe {
                      width: 200px;
                      height: 200px;
                      margin: 40px auto;
                      background: linear-gradient(45deg, #00f260, #0575e6);
                      border-radius: 50%;
                      position: relative;
                      box-shadow: 0 0 60px rgba(0,242,96,0.3), inset 0 0 60px rgba(0,0,0,0.3);
                      animation: rotate 20s linear infinite;
                  }
                  @keyframes rotate {
                      from { transform: rotate(0deg); }
                      to { transform: rotate(360deg); }
                  }
                  .features {
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                      gap: 30px;
                      margin: 60px 0;
                  }
                  .feature-card {
                      background: rgba(255,255,255,0.05);
                      backdrop-filter: blur(10px);
                      border: 1px solid rgba(255,255,255,0.1);
                      border-radius: 20px;
                      padding: 30px;
                      transition: all 0.3s ease;
                  }
                  .feature-card:hover {
                      transform: translateY(-5px);
                      background: rgba(255,255,255,0.1);
                      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
                  }
                  .feature-icon {
                      font-size: 3rem;
                      margin-bottom: 20px;
                  }
                  .feature-title {
                      font-size: 1.5rem;
                      font-weight: 700;
                      margin-bottom: 15px;
                      color: #00f260;
                  }
                  .feature-desc {
                      color: rgba(255,255,255,0.7);
                      line-height: 1.6;
                  }
                  .downloads {
                      background: rgba(0,0,0,0.3);
                      border-radius: 30px;
                      padding: 50px;
                      margin: 60px 0;
                      text-align: center;
                  }
                  .downloads h2 {
                      font-size: 2.5rem;
                      margin-bottom: 40px;
                  }
                  .download-grid {
                      display: grid;
                      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
                      gap: 30px;
                      max-width: 800px;
                      margin: 0 auto;
                  }
                  .download-card {
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      border-radius: 20px;
                      padding: 40px 30px;
                      text-decoration: none;
                      color: white;
                      transition: all 0.3s ease;
                      position: relative;
                      overflow: hidden;
                  }
                  .download-card::before {
                      content: '';
                      position: absolute;
                      top: 0; left: 0; right: 0; bottom: 0;
                      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                      opacity: 0;
                      transition: opacity 0.3s;
                  }
                  .download-card:hover::before {
                      opacity: 1;
                  }
                  .download-card.proxy {
                      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                  }
                  .download-card.proxy::before {
                      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                  }
                  .download-content {
                      position: relative;
                      z-index: 1;
                  }
                  .download-icon {
                      font-size: 4rem;
                      margin-bottom: 20px;
                  }
                  .download-title {
                      font-size: 1.8rem;
                      font-weight: 700;
                      margin-bottom: 10px;
                  }
                  .download-desc {
                      font-size: 0.95rem;
                      opacity: 0.9;
                  }
                  .player-section {
                      text-align: center;
                      margin: 60px 0;
                  }
                  .player-btn {
                      display: inline-flex;
                      align-items: center;
                      gap: 15px;
                      background: linear-gradient(90deg, #00f260, #0575e6);
                      color: white;
                      text-decoration: none;
                      padding: 20px 50px;
                      border-radius: 50px;
                      font-size: 1.3rem;
                      font-weight: 700;
                      transition: all 0.3s ease;
                      box-shadow: 0 10px 30px rgba(0,242,96,0.3);
                  }
                  .player-btn:hover {
                      transform: scale(1.05);
                      box-shadow: 0 20px 40px rgba(0,242,96,0.4);
                  }
                  .countries {
                      display: flex;
                      flex-wrap: wrap;
                      justify-content: center;
                      gap: 15px;
                      margin: 40px 0;
                  }
                  .country-tag {
                      background: rgba(255,255,255,0.1);
                      padding: 10px 20px;
                      border-radius: 30px;
                      font-size: 0.9rem;
                      border: 1px solid rgba(255,255,255,0.2);
                  }
                  footer {
                      text-align: center;
                      padding: 40px;
                      color: rgba(255,255,255,0.5);
                      border-top: 1px solid rgba(255,255,255,0.1);
                      margin-top: 60px;
                  }
                  .pulse {
                      animation: pulse 2s infinite;
                  }
                  @keyframes pulse {
                      0%, 100% { opacity: 1; }
                      50% { opacity: 0.7; }
                  }
              </style>
          </head>
          <body>
              <div class="stars"></div>
              <div class="container">
                  <header>
                      <div class="logo">üì°</div>
                      <h1>IPTV WORLD</h1>
                      <p class="subtitle">–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ç–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ –±–µ–∑ –≥—Ä–∞–Ω–∏—Ü. –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π —Ç–æ—á–∫–µ –º–∏—Ä–∞ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º –æ–±—Ö–æ–¥–æ–º –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.</p>
                      <div class="globe"></div>
                  </header>

                  <div class="countries">
                      <span class="country-tag">üá∑üá∫ –†–æ—Å—Å–∏—è</span>
                      <span class="country-tag">üá∫üá∏ –°–®–ê</span>
                      <span class="country-tag">üá™üá∫ –ï–≤—Ä–æ–ø–∞</span>
                      <span class="country-tag">üá®üá≥ –ê–∑–∏—è</span>
                      <span class="country-tag">üáßüá∑ –õ–∞—Ç–∏–Ω—Å–∫–∞—è –ê–º–µ—Ä–∏–∫–∞</span>
                      <span class="country-tag">üáøüá¶ –ê—Ñ—Ä–∏–∫–∞</span>
                      <span class="country-tag">üá¶üá∫ –û–∫–µ–∞–Ω–∏—è</span>
                  </div>

                  <div class="features">
                      <div class="feature-card">
                          <div class="feature-icon">üåç</div>
                          <div class="feature-title">–ì–ª–æ–±–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ</div>
                          <div class="feature-desc">–†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–π —Å—Ç—Ä–∞–Ω–µ –º–∏—Ä–∞ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞.</div>
                      </div>
                      <div class="feature-card">
                          <div class="feature-icon">üõ°Ô∏è</div>
                          <div class="feature-title">Anti-DPI –∑–∞—â–∏—Ç–∞</div>
                          <div class="feature-desc">–û–±—Ö–æ–¥ –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤. –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º.</div>
                      </div>
                      <div class="feature-card">
                          <div class="feature-icon">‚ö°</div>
                          <div class="feature-title">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å</div>
                          <div class="feature-desc">–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã. –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω–∞.</div>
                      </div>
                      <div class="feature-card">
                          <div class="feature-icon">üîí</div>
                          <div class="feature-title">DNS-over-HTTPS</div>
                          <div class="feature-desc">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ DNS-–∑–∞–ø—Ä–æ—Å—ã. –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å.</div>
                      </div>
                      <div class="feature-card">
                          <div class="feature-icon">üì±</div>
                          <div class="feature-title">–í—Å–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
                          <div class="feature-desc">Smart TV, —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∫–æ–º–ø—å—é—Ç–µ—Ä—ã, TV-–ø—Ä–∏—Å—Ç–∞–≤–∫–∏. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤.</div>
                      </div>
                      <div class="feature-card">
                          <div class="feature-icon">üîÑ</div>
                          <div class="feature-title">–ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</div>
                          <div class="feature-desc">–ü–ª–µ–π–ª–∏—Å—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏. –í—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã.</div>
                      </div>
                  </div>

                  <div class="downloads">
                      <h2>üì• –°–∫–∞—á–∞—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç</h2>
                      <div class="download-grid">
                          <a href="RELEASE_ORIGINAL_URL" class="download-card" target="_blank">
                              <div class="download-content">
                                  <div class="download-icon">üåê</div>
                                  <div class="download-title">STANDARD</div>
                                  <div class="download-desc">–î–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω –º–∏—Ä–∞<br>–ë–µ–∑ –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫</div>
                              </div>
                          </a>
                          <a href="RELEASE_PROXY_URL" class="download-card proxy" target="_blank">
                              <div class="download-content">
                                  <div class="download-icon">üîí</div>
                                  <div class="download-title">PROXY</div>
                                  <div class="download-desc">–î–ª—è –†–æ—Å—Å–∏–∏ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫<br>Anti-DPI + DNS –æ–±—Ö–æ–¥</div>
                              </div>
                          </a>
                      </div>
                  </div>

                  <div class="player-section">
                      <h2 style="font-size: 2rem; margin-bottom: 30px;">‚ñ∂Ô∏è –°–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω</h2>
                      <a href="player/" class="player-btn pulse">
                          <span>üì∫</span>
                          <span>–û—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ø–ª–µ–µ—Ä</span>
                      </a>
                      <p style="margin-top: 20px; color: rgba(255,255,255,0.6);">–†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä—è–º–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–∫–∏</p>
                  </div>

                  <footer>
                      <p>üöÄ IPTV World ¬© 2024 | –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Ç–µ–ª–µ–≤–∏–¥–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è</p>
                      <p style="margin-top: 10px; font-size: 0.9rem;">–û–±–Ω–æ–≤–ª–µ–Ω–æ: BUILD_DATE</p>
                  </footer>
              </div>
          </body>
          </html>
          HTMLEOF

          # –ó–∞–º–µ–Ω—è–µ–º URL –≤ —à–∞–±–ª–æ–Ω–µ
          sed -i "s|RELEASE_ORIGINAL_URL|${{ steps.download.outputs.link_orig }}|g" _site/index.html
          sed -i "s|RELEASE_PROXY_URL|${{ steps.download.outputs.link_proxy }}|g" _site/index.html
          sed -i "s|BUILD_DATE|${{ steps.timestamp.outputs.date }}|g" _site/index.html

          # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–ª–µ–µ—Ä–∞
          cat > _site/player/index.html << 'PLAYEREOF'
          <!DOCTYPE html>
          <html lang="ru">
          <head>
              <meta charset="UTF-8">
              <meta name="viewport" content="width=device-width, initial-scale=1.0">
              <title>‚ñ∂Ô∏è IPTV Player - –û–Ω–ª–∞–π–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä</title>
              <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
              <script src="https://cdn.jsdelivr.net/npm/mux.js@latest"></script>
              <style>
                  * { margin: 0; padding: 0; box-sizing: border-box; }
                  body {
                      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                      background: #0a0a0a;
                      color: #fff;
                      min-height: 100vh;
                  }
                  .header {
                      background: linear-gradient(90deg, #1a1a2e 0%, #16213e 100%);
                      padding: 20px;
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      border-bottom: 1px solid rgba(255,255,255,0.1);
                  }
                  .logo {
                      font-size: 1.5rem;
                      font-weight: 700;
                      display: flex;
                      align-items: center;
                      gap: 10px;
                  }
                  .back-btn {
                      background: rgba(255,255,255,0.1);
                      color: white;
                      text-decoration: none;
                      padding: 10px 20px;
                      border-radius: 8px;
                      transition: all 0.3s;
                  }
                  .back-btn:hover {
                      background: rgba(255,255,255,0.2);
                  }
                  .main-container {
                      display: grid;
                      grid-template-columns: 350px 1fr;
                      height: calc(100vh - 80px);
                  }
                  .playlist-panel {
                      background: #1a1a1a;
                      border-right: 1px solid rgba(255,255,255,0.1);
                      overflow-y: auto;
                  }
                  .panel-header {
                      padding: 20px;
                      background: #252525;
                      border-bottom: 1px solid rgba(255,255,255,0.1);
                  }
                  .panel-title {
                      font-size: 1.2rem;
                      font-weight: 600;
                      margin-bottom: 15px;
                  }
                  .playlist-selector {
                      display: flex;
                      gap: 10px;
                      margin-bottom: 15px;
                  }
                  .playlist-btn {
                      flex: 1;
                      padding: 10px;
                      border: none;
                      border-radius: 8px;
                      cursor: pointer;
                      font-size: 0.85rem;
                      transition: all 0.3s;
                  }
                  .playlist-btn.standard {
                      background: #667eea;
                      color: white;
                  }
                  .playlist-btn.proxy {
                      background: #f5576c;
                      color: white;
                  }
                  .playlist-btn.active {
                      box-shadow: 0 0 0 2px #fff;
                  }
                  .search-box {
                      width: 100%;
                      padding: 12px;
                      border: 1px solid rgba(255,255,255,0.2);
                      border-radius: 8px;
                      background: #0a0a0a;
                      color: white;
                      font-size: 0.9rem;
                  }
                  .search-box:focus {
                      outline: none;
                      border-color: #667eea;
                  }
                  .channel-list {
                      padding: 10px;
                  }
                  .channel-item {
                      display: flex;
                      align-items: center;
                      gap: 15px;
                      padding: 12px;
                      border-radius: 10px;
                      cursor: pointer;
                      transition: all 0.2s;
                      margin-bottom: 5px;
                  }
                  .channel-item:hover {
                      background: rgba(102, 126, 234, 0.2);
                  }
                  .channel-item.active {
                      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
                  }
                  .channel-logo {
                      width: 50px;
                      height: 50px;
                      border-radius: 10px;
                      background: rgba(255,255,255,0.1);
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 1.5rem;
                      flex-shrink: 0;
                  }
                  .channel-info {
                      flex: 1;
                      min-width: 0;
                  }
                  .channel-name {
                      font-weight: 600;
                      margin-bottom: 4px;
                      white-space: nowrap;
                      overflow: hidden;
                      text-overflow: ellipsis;
                  }
                  .channel-group {
                      font-size: 0.8rem;
                      color: rgba(255,255,255,0.6);
                  }
                  .player-area {
                      display: flex;
                      flex-direction: column;
                      background: #000;
                  }
                  .video-container {
                      flex: 1;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      position: relative;
                  }
                  video {
                      width: 100%;
                      height: 100%;
                      max-height: calc(100vh - 200px);
                  }
                  .controls {
                      background: linear-gradient(0deg, rgba(0,0,0,0.9) 0%, transparent 100%);
                      padding: 30px;
                      position: absolute;
                      bottom: 0;
                      left: 0;
                      right: 0;
                      opacity: 0;
                      transition: opacity 0.3s;
                  }
                  .video-container:hover .controls {
                      opacity: 1;
                  }
                  .control-bar {
                      display: flex;
                      align-items: center;
                      gap: 20px;
                  }
                  .play-btn {
                      width: 50px;
                      height: 50px;
                      border-radius: 50%;
                      background: white;
                      border: none;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      font-size: 1.2rem;
                  }
                  .progress-bar {
                      flex: 1;
                      height: 4px;
                      background: rgba(255,255,255,0.3);
                      border-radius: 2px;
                      cursor: pointer;
                      position: relative;
                  }
                  .progress-fill {
                      height: 100%;
                      background: #667eea;
                      border-radius: 2px;
                      width: 0%;
                  }
                  .volume-control {
                      display: flex;
                      align-items: center;
                      gap: 10px;
                  }
                  .status-bar {
                      background: #1a1a1a;
                      padding: 15px 30px;
                      display: flex;
                      justify-content: space-between;
                      align-items: center;
                      border-top: 1px solid rgba(255,255,255,0.1);
                  }
                  .status-info {
                      display: flex;
                      align-items: center;
                      gap: 20px;
                  }
                  .status-item {
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      font-size: 0.9rem;
                      color: rgba(255,255,255,0.7);
                  }
                  .status-dot {
                      width: 8px;
                      height: 8px;
                      border-radius: 50%;
                      background: #00f260;
                      animation: pulse 2s infinite;
                  }
                  @keyframes pulse {
                      0%, 100% { opacity: 1; }
                      50% { opacity: 0.5; }
                  }
                  .loading {
                      position: absolute;
                      top: 50%;
                      left: 50%;
                      transform: translate(-50%, -50%);
                      font-size: 3rem;
                      animation: spin 1s linear infinite;
                  }
                  @keyframes spin {
                      from { transform: translate(-50%, -50%) rotate(0deg); }
                      to { transform: translate(-50%, -50%) rotate(360deg); }
                  }
                  @media (max-width: 900px) {
                      .main-container {
                          grid-template-columns: 1fr;
                      }
                      .playlist-panel {
                          position: fixed;
                          left: -100%;
                          top: 80px;
                          width: 80%;
                          height: calc(100vh - 80px);
                          z-index: 100;
                          transition: left 0.3s;
                      }
                      .playlist-panel.open {
                          left: 0;
                      }
                  }
              </style>
          </head>
          <body>
              <div class="header">
                  <div class="logo">üì∫ IPTV World Player</div>
                  <a href="../" class="back-btn">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
              </div>
              
              <div class="main-container">
                  <div class="playlist-panel" id="playlistPanel">
                      <div class="panel-header">
                          <div class="panel-title">üìã –ö–∞–Ω–∞–ª—ã</div>
                          <div class="playlist-selector">
                              <button class="playlist-btn standard active" onclick="switchPlaylist('standard')">üåê Standard</button>
                              <button class="playlist-btn proxy" onclick="switchPlaylist('proxy')">üîí Proxy</button>
                          </div>
                          <input type="text" class="search-box" placeholder="üîç –ü–æ–∏—Å–∫ –∫–∞–Ω–∞–ª–∞..." id="searchBox" onkeyup="filterChannels()">
                      </div>
                      <div class="channel-list" id="channelList">
                          <div class="loading">‚è≥</div>
                      </div>
                  </div>
                  
                  <div class="player-area">
                      <div class="video-container" id="videoContainer">
                          <video id="videoPlayer" controls></video>
                          <div class="loading" id="loader" style="display: none;">‚è≥</div>
                      </div>
                      <div class="status-bar">
                          <div class="status-info">
                              <div class="status-item">
                                  <div class="status-dot"></div>
                                  <span id="currentChannel">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–Ω–∞–ª</span>
                              </div>
                              <div class="status-item">
                                  üìä <span id="channelCount">0 –∫–∞–Ω–∞–ª–æ–≤</span>
                              </div>
                          </div>
                          <div class="status-item">
                              üöÄ <span id="connectionType">Standard</span>
                          </div>
                      </div>
                  </div>
              </div>

              <script>
                  const PLAYLIST_URLS = {
                      standard: 'PLAYLIST_STANDARD_URL',
                      proxy: 'PLAYLIST_PROXY_URL'
                  };
                  
                  let currentPlaylist = 'standard';
                  let channels = [];
                  let hls = null;
                  let currentChannelIndex = -1;

                  async function loadPlaylist(type) {
                      currentPlaylist = type;
                      document.getElementById('connectionType').textContent = type === 'proxy' ? 'üîí Proxy Mode' : 'üåê Standard';
                      document.getElementById('loader').style.display = 'block';
                      
                      try {
                          // –ò—Å–ø–æ–ª—å–∑—É–µ–º CORS-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –ø–ª–µ–π–ª–∏—Å—Ç–∞
                          const corsProxy = 'https://api.allorigins.win/raw?url=';
                          const response = await fetch(corsProxy + encodeURIComponent(PLAYLIST_URLS[type]));
                          const text = await response.text();
                          parsePlaylist(text);
                      } catch (e) {
                          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
                          alert('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–µ–π–ª–∏—Å—Ç. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ä–µ–∂–∏–º.');
                      }
                      
                      document.getElementById('loader').style.display = 'none';
                  }

                  function parsePlaylist(m3uContent) {
                      channels = [];
                      const lines = m3uContent.split('\n');
                      let currentChannel = {};
                      
                      for (let line of lines) {
                          line = line.trim();
                          if (line.startsWith('#EXTINF:')) {
                              const nameMatch = line.match(/tvg-name="([^"]+)"/) || line.match(/,(.+)$/);
                              const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                              const groupMatch = line.match(/group-title="([^"]+)"/);
                              
                              currentChannel = {
                                  name: nameMatch ? nameMatch[1] : 'Unknown',
                                  logo: logoMatch ? logoMatch[1] : '',
                                  group: groupMatch ? groupMatch[1] : 'General',
                                  url: ''
                              };
                          } else if (line && !line.startsWith('#') && currentChannel.name) {
                              currentChannel.url = line;
                              channels.push({...currentChannel});
                              currentChannel = {};
                          }
                      }
                      
                      renderChannels();
                      document.getElementById('channelCount').textContent = channels.length + ' –∫–∞–Ω–∞–ª–æ–≤';
                  }

                  function renderChannels(filter = '') {
                      const list = document.getElementById('channelList');
                      list.innerHTML = '';
                      
                      const filtered = channels.filter(ch => 
                          ch.name.toLowerCase().includes(filter.toLowerCase())
                      );
                      
                      filtered.forEach((ch, index) => {
                          const div = document.createElement('div');
                          div.className = 'channel-item' + (index === currentChannelIndex ? ' active' : '');
                          div.onclick = () => playChannel(index);
                          
                          const logo = ch.logo ? 
                              `<img src="${ch.logo}" style="width:100%;height:100%;object-fit:cover;border-radius:10px;" onerror="this.style.display='none'">` :
                              'üì∫';
                          
                          div.innerHTML = `
                              <div class="channel-logo">${logo}</div>
                              <div class="channel-info">
                                  <div class="channel-name">${ch.name}</div>
                                  <div class="channel-group">${ch.group}</div>
                              </div>
                          `;
                          list.appendChild(div);
                      });
                  }

                  function playChannel(index) {
                      if (index < 0 || index >= channels.length) return;
                      
                      currentChannelIndex = index;
                      const channel = channels[index];
                      document.getElementById('currentChannel').textContent = channel.name;
                      
                      const video = document.getElementById('videoPlayer');
                      
                      if (hls) {
                          hls.destroy();
                      }
                      
                      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É HLS
                      if (Hls.isSupported()) {
                          hls = new Hls({
                              enableWorker: true,
                              lowLatencyMode: true,
                              backBufferLength: 90
                          });
                          
                          // –î–ª—è –ø—Ä–æ–∫—Å–∏-—Ä–µ–∂–∏–º–∞ –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏
                          if (currentPlaylist === 'proxy') {
                              hls.config.xhrSetup = function(xhr, url) {
                                  xhr.setRequestHeader('X-Forwarded-For', generateRandomIP());
                              };
                          }
                          
                          hls.loadSource(channel.url);
                          hls.attachMedia(video);
                          hls.on(Hls.Events.MANIFEST_PARSED, () => {
                              video.play();
                          });
                      } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                          video.src = channel.url;
                          video.play();
                      }
                      
                      renderChannels(document.getElementById('searchBox').value);
                  }

                  function generateRandomIP() {
                      return `${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`;
                  }

                  function switchPlaylist(type) {
                      document.querySelectorAll('.playlist-btn').forEach(btn => btn.classList.remove('active'));
                      event.target.classList.add('active');
                      loadPlaylist(type);
                  }

                  function filterChannels() {
                      const search = document.getElementById('searchBox').value;
                      renderChannels(search);
                  }

                  // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–ª–µ–π–ª–∏—Å—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
                  loadPlaylist('standard');
              </script>
          </body>
          </html>
          PLAYEREOF

          # –ó–∞–º–µ–Ω—è–µ–º URL –≤ –ø–ª–µ–µ—Ä–µ
          sed -i "s|PLAYLIST_STANDARD_URL|${{ steps.download.outputs.link_orig }}|g" _site/player/index.html
          sed -i "s|PLAYLIST_PROXY_URL|${{ steps.download.outputs.link_proxy }}|g" _site/player/index.html

          # –ö–æ–ø–∏—Ä—É–µ–º –ø–ª–µ–π–ª–∏—Å—Ç—ã –≤ —Å–∞–π—Ç –¥–ª—è –ø—Ä—è–º–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
          cp IPTV_WORLD.m3u _site/
          cp IPTV_WORLD_PROXY.m3u _site/

          echo "‚úÖ –°–∞–π—Ç —Å–æ–∑–¥–∞–Ω"

      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'

      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v4

      - name: Summary
        run: |
          echo "## üöÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üì• –°—Å—ã–ª–∫–∏ –Ω–∞ –ø–ª–µ–π–ª–∏—Å—Ç—ã:" >> $GITHUB_STEP_SUMMARY
          echo "- üåê **Standard:** ${{ steps.download.outputs.link_orig }}" >> $GITHUB_STEP_SUMMARY
          echo "- üîí **Proxy:** ${{ steps.download.outputs.link_proxy }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üåê –°–∞–π—Ç:" >> $GITHUB_STEP_SUMMARY
          echo "- **–ì–ª–∞–≤–Ω–∞—è:** https://${{ github.repository_owner }}.github.io/IPTVMIR/" >> $GITHUB_STEP_SUMMARY
          echo "- **–ü–ª–µ–µ—Ä:** https://${{ github.repository_owner }}.github.io/IPTVMIR/player/" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### üì¶ –†–µ–ª–∏–∑:" >> $GITHUB_STEP_SUMMARY
          echo "- **–í–µ—Ä—Å–∏—è:** v${{ steps.timestamp.outputs.version }}" >> $GITHUB_STEP_SUMMARY
          echo "- **–î–∞—Ç–∞:** ${{ steps.timestamp.outputs.date }}" >> $GITHUB_STEP_SUMMARY
